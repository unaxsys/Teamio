# Teamio MVP спецификация (първа версия)

## Цел на документа
Този документ дефинира **конкретни критерии за приемане** на MVP, по които се счита, че версията е „готова“.

## Статус на имплементация (текущ прогрес)
- [x] Стартирана е имплементация на имейл потвърждение (backend token flow + verify endpoint + UI обработка на verify линк).
- [ ] Бордове (пълен CRUD по отделни обекти board).
- [ ] Колони с персистентно подреждане по `position`.
- [ ] Карти с `PATCH /cards/:id/move` backend endpoint.
- [ ] Покани по имейл с роли и срок.

---

## 1) Обхват на MVP (какво задължително влиза)

### 1.1 Акаунти и Workspace
- Регистрация с имейл и парола.
- Потвърждение на имейл (email verification).
- Вход/изход.
- „Забравена парола“ с имейл линк за смяна.

### 1.2 Бордове (Boards)
- Списък с бордове.
- Създаване, редакция и изтриване на борд.

### 1.3 Колони (Lists)
- Създаване и редакция на колони.
- Подреждане на колони.

### 1.4 Карти (Cards)
- Създаване и редакция на карти.
- Drag & drop между колони и вътре в колона.
- Полета: заглавие, описание, срок (due date).
- Етикети: опционално за MVP.

### 1.5 Покани по имейл
- Owner/Admin кани потребители по имейл.
- Приемане на покана чрез линк.

### 1.6 Роли
- Owner / Admin / Member / Viewer.

---

## 2) UX критерии (задължителни за MVP)
1. **1 клик за добавяне**: във всяка колона има видим бутон „+ Карта“.
2. **Inline добавяне**: при „+ Карта“ се показва директно поле в колоната (без задължителен модал).
3. **Минимални модали**: детайлите на карта се отварят в страничен панел (drawer).
4. **Клавишни действия**: `Enter` добавя/потвърждава, `Esc` затваря текущо въвеждане/панел.
5. **Автосейв**: промените по карта/колона се записват автоматично.
6. **Празни състояния**: има ясни текстове за празен борд/колона.
7. **Ясни права**: UI ясно показва кога действие е забранено поради роля.

---

## 3) Роли и права (критерии)

### Owner
- Има пълен достъп върху борда.
- Може да кани/премахва потребители.
- Може да сменя роли.
- Може да изтрива борда.

### Admin
- Може да управлява колони и карти.
- Може да кани потребители (ако това е включено за конкретната инсталация).
- Не може да изтрие/прехвърли ownership, освен ако не е изрично разрешено.

### Member
- Може да създава/редактира/мести карти.
- Може да работи с колони според правилата на борда.

### Viewer
- Има само read-only достъп.
- Не вижда активни UI контроли за редакция (или са disabled с обяснение).

---

## 4) Критерии за функционално приемане по модул

### 4.1 Регистрация, вход, имейл потвърждение
**Приема се за готово, когато:**
- Регистрация създава потребител с `is_email_verified = false`.
- Генерира се verification token и се изпраща линк.
- Отваряне на валиден линк маркира `is_email_verified = true`.
- Вход с грешни данни връща смислено съобщение без изтичане на чувствителна информация.

### 4.2 Забравена парола
**Приема се за готово, когато:**
- При заявка се създава reset token с краен срок.
- Изпраща се имейл линк за смяна.
- Използван/изтекъл token не може да се използва повторно.
- При успешна смяна паролата се обновява и старият token е невалиден.

### 4.3 Бордове
**Приема се за готово, когато:**
- Потребител с права вижда списък с бордовете си.
- Може да създаде борд и той се появява веднага в списъка.
- Може да редактира име на борд.
- Може да изтрие борд (само роля с право).

### 4.4 Колони
**Приема се за готово, когато:**
- Може да се добави колона.
- Може да се преименува колона.
- Може да се подреждат колони и редът се пази след refresh.

### 4.5 Карти и drag & drop
**Приема се за готово, когато:**
- Може да се добави карта в конкретна колона.
- Може да се редактират title/description/due date.
- Drag & drop в същата колона променя реда коректно.
- Drag & drop към друга колона премества картата коректно.
- След refresh редът и колоната на картата остават коректни.

### 4.6 Покани
**Приема се за готово, когато:**
- Owner/Admin може да създаде покана по имейл с роля.
- Поканата има срок (например 48 часа).
- Валиден token добавя потребителя като член с правилната роля.
- Изтекъл/невалиден token връща ясно съобщение и не добавя членство.

---

## 5) Минимална база данни (PostgreSQL)
```sql
users (
  id,
  email UNIQUE,
  password_hash,
  is_email_verified,
  created_at
)

workspaces (
  id,
  name,
  owner_id
)

workspace_members (
  workspace_id,
  user_id,
  role
)

boards (
  id,
  workspace_id,
  name,
  created_by
)

board_members (
  board_id,
  user_id,
  role
)

lists (
  id,
  board_id,
  title,
  position
)

cards (
  id,
  list_id,
  title,
  description,
  position,
  due_date,
  created_by
)

invites (
  id,
  board_id, -- или workspace_id
  email,
  role,
  token_hash,
  expires_at,
  accepted_at
)
```

> Важно: в базата се пази само `token_hash`, никога raw token.

---

## 6) API критерий за преместване на карта

### Request
```http
PATCH /cards/:id/move
```
Примерен payload:
```json
{
  "toListId": "...",
  "newPosition": 1500
}
```

### Критерий
- Backend обновява позицията на картата в целевата колона.
- При междуколонно местене се синхронизират позиции в source/target.
- Използва се позициониране с `float/decimal` (напр. `1000, 2000, 3000`).
- Има механизъм за normalize/rebalance при нужда.

---

## 7) Definition of Done за MVP
MVP е „готово“, ако са изпълнени едновременно:
1. Всички критерии от секции **2, 3 и 4**.
2. Няма blocker дефекти по регистрация, вход, покани, drag & drop.
3. Правата по роли работят консистентно в UI и backend.
4. Данните за ред на колони/карти се запазват след refresh.
5. Основният потребителски поток е изпълним без допълнителни ръчни стъпки от администратор.

---

## 8) Извън обхват за v1
- Сложна автоматизация/правила.
- Детайлни permission матрици по поле.
- Dependency graph/Gantt.
- Задължително real-time съвместно редактиране.
